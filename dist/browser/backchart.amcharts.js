/*! Backchart - v0.1.0 - 2014-03-12
* https://github.com/xch89820/backchart
* Copyright (c) 2014 xu.chenhui; Licensed MIT */
!function(a,b,c){"use strict";if("function"==typeof define&&define.amd)define(["jquery","backbone"],function(a,b){return c(a,b)});else if("undefined"!=typeof module&&module.exports){var d=require("jquery"),e=require("backbone");module.exports=c(d,e)}else for(var f=b.split("."),g=a||this,h=0;h<f.length;h++){var i=f[h],j=g[i];g=g[i]=h===f.length-1?c(a.jQuery||window.jQuery,a.Backbone||window.Backbone):j||{}}}(this,"backchart.base.model",function(a,b){var c=b.Model.extend({});return c}),function(a,b,c){"use strict";if("function"==typeof define&&define.amd)define(["jquery","backbone"],function(a,b){return c(a,b)});else if("undefined"!=typeof module&&module.exports){var d=require("jquery"),e=require("backbone");module.exports=c(d,e)}else for(var f=b.split("."),g=a||this,h=0;h<f.length;h++){var i=f[h],j=g[i];g=g[i]=h===f.length-1?c(a.jQuery||window.jQuery,a.Backbone||window.Backbone):j||{}}}(this,"backchart.base.collection",function(a,b){var c=b.Collection.extend({_backchart:!0,initialize:function(){return this._silence=!1,this._modelOptions={},b.Collection.prototype.initialize.apply(this,arguments)},setSilence:function(a){this._silence=a},set:function(c,d){var e=a.extend({silent:!0},d);if(this._silence===!0)return b.Collection.prototype.set.apply(this,[c,e]);this.setSilence(!0);var f=b.Collection.prototype.set.apply(this,[c,e]);return this.setSilence(!1),this.trigger("seted",this.models,this,d),f},remove:function(c,d){var e=a.extend({silent:!0},d);if(this._silence===!0)return b.Collection.prototype.remove.apply(this,[c,e]);this.setSilence(!0);var f=b.Collection.prototype.remove.apply(this,[c,e]);this.setSilence(!1);for(var g=c.length;g>=0;g--){var h=c[g];this._modelOptions[h]&&delete this._modelOptions[h]}return this.trigger("removed",this.models,this,d),f},reset:function(a,c){if(this._silence===!0)return b.Collection.prototype.reset.apply(this,arguments);this.setSilence(!0);var d=b.Collection.prototype.reset.apply(this,arguments);return this.setSilence(!1),this.trigger("reseted",this,c),d},getOptions:function(a){var c=this;if((a instanceof String||"string"==typeof a)&&(a=c.get(a)),a instanceof b.Model)for(var d=c.models.length-1;d>=0;d--){var e=c.models[d];if(e.cid===a.cid)return c._modelOptions[e.cid]||(c._modelOptions[e.cid]={}),c._modelOptions[e.cid]}return null},_setOptions:function(b,c){var d=this;return d._modelOptions[b.cid]=d._modelOptions[b.cid]?a.extend(d._modelOptions[b.cid],c):a.extend({},c),d._modelOptions[b.cid]},setOptions:function(a,c){var d=this;if((a instanceof String||"string"==typeof a)&&(a=d.get(a)),a instanceof b.Model)for(var e=d.models.length-1;e>=0;e--){var f=d.models[e];f.cid===a.cid&&d._setOptions(a,c)}return null},_setVisible:function(a,c){var d=this;if((a instanceof String||"string"==typeof a)&&(a=d.get(a)),a instanceof b.Model)for(var e=d.models.length-1;e>=0;e--){var f=d.models[e];if(f.cid===a.cid)return d._setoptions(a,{visible:c}),d.trigger("change:visible",c),a}return null},hide:function(a){return this._setVisible(a,!1)},show:function(a){return this._setVisible(a,!0)},isVisibled:function(a){var b=this.getOptions(a);return b?b.visible===!1?!1:!0:!0}});return c}),function(a,b,c){"use strict";if("function"==typeof define&&define.amd)define(["jquery","backbone","underscore"],function(a,b,d){return c(a,b,d)});else if("undefined"!=typeof module&&module.exports){var d=require("jquery"),e=require("underscore"),f=require("backbone");module.exports=c(d,f,e)}else for(var g=b.split("."),h=a||this,i=0;i<g.length;i++){var j=g[i],k=h[j];h=h[j]=i===g.length-1?c(a.jQuery||window.jQuery,a.Backbone||window.Backbone,a._||window._):k||{}}}(this,"backchart.base.view",function(a,b,c){var d=b.View.extend({tagName:"div",className:"backchart",_collectionPrefix:"_bcname",_viewPrefix:"_bcview",container:null,eventCallback:{"default":"render"},_getEventCallback:function(a){var b=this.eventCallback[a]||this.eventCallback["default"];return b?this[b]:this.render},setSilence:function(a){this._silence=a},_setVisible:function(a,c){var d=this;if("string"==typeof a||a instanceof String){var e=d._collectionOptions[a];e&&(e.visible=c)}else a instanceof b.Collection&&d.eachCollection(function(b,d,e,f){d===a&&(f.visible=c)});return d.render(),d},hide:function(a){return this._setVisible(a,!1)},show:function(a){return this._setVisible(a,!0)},isVisibled:function(a){var c=this;if("string"==typeof a||a instanceof String){var d=c._collectionOptions[a];return d?d.visible:!1}if(a instanceof b.Collection){var e={};return c.eachCollection(function(b,c,d,f){c===a&&(e[b]=f?f.visible:!1)}),e}},initialize:function(){var a=this;a._silence=!1,b.View.prototype.initialize.apply(this,arguments),a.collections={},a._collectionOptions={},a._collectionRenderOptions={},this.on("collection.on",function(b,c,d,e){e.renderAfterOn===!0&&a.render(!0)}),this.on("collection.off",function(){a.render(!0)})},__bce:function(a,b,d){var e=this;c.each(b,function(a){e.listenTo(d,a,e._getEventCallback(a))})},__ubce:function(a,b,d){var e=this;c.each(b,function(a){d.off(a,e._getEventCallback(a))})},_getBindEvents:function(a){var b=["set","add","change","destroy","reset","sort"];return"undefined"!=typeof a._backchart&&(b=["seted","removed","change","destroy","reseted","sort","change:visible"]),b},_bindCollectionEvent:function(a,b,c){c.silence!==!0&&this.__bce(a,this._getBindEvents(b),b)},_unbindColletionEvent:function(a,b){this.__ubce(a,this._getBindEvents(b),b)},_collectionHasBind:function(a){for(var b in this.collections)if(this.collections[b]===a)return!0;return!1},onCollection:function(a,d,e){d=d||{},e=e||{};var f=this,g=e.bid||c.uniqueId(f._collectionPrefix);if(!(!a instanceof b.Collection)){f._collectionHasBind(a)||(f._bindCollectionEvent(g,a,e),f.trigger("collection.bindEvent",a)),f.collections[g]=a;var h=c.clone(d);return f._collectionOptions[g]=e,f._collectionRenderOptions[g]=h,f.trigger("collection.on",g,a,h,e),g}},onCollections:function(a,b,d){var e=this;!a instanceof Array&&(a=[a]);var f={};return c.each(a,function(a){f[a]=e.onCollection(a,b,d)}),f},unCollection:function(a){var d=this,e=null;if("string"==typeof a||a instanceof String){if(e=d.collections[a]){delete d.collections[a];var f=d._collectionRenderOptions[a],g=d._collectionOptions[a];delete d._collectionRenderOptions[a],delete d._collectionOptions[a],d._collectionHasBind(e)||(d._unbindColletionEvent(a,e),d.trigger("collection.unbindEvent",e)),d.trigger("collection.off",a,e,f,g)}return e}if(a instanceof b.Collection){var h=[];e=a;for(var i in d.collections)d.collections[i]===e&&h.push(i);return c.each(h,function(a){d.unCollection(a)}),e}},clearCollection:function(){var a=this,b=c.keys(this.collections);return c.each(b,function(b){a.unCollection(b)}),this},eachCollection:function(a){var b=this;for(var c in b.collections)a.call(b.collections[c],c,b.collections[c],b._collectionRenderOptions[c],b._collectionOptions[c])},getCollection:function(a){var d=this;if("boolean"==typeof a&&a===!1)return c.uniq(c.values(d.collections));if("string"==typeof a||a instanceof String)return d.collections[a];if(a instanceof b.Collection){var e=[];return d.eachCollection(function(b){this===a&&e.push(b)}),e}var f={};return d.eachCollection(function(a){"undefined"==typeof f[this]&&(f[this]=[]),f[this].push(a)}),f},getOptions:function(a){var c=this,d=null;return"string"==typeof a||a instanceof String?c._collectionOptions[a]:a instanceof b.Collection?(d=[],c.eachCollection(function(b,c,e,f){c===a&&d.push(f)}),d):(d={},c.eachCollection(function(a,b,c,e){"undefined"==typeof d[this]&&(d[this]=[]),d[this].push(e)}),d)},getRenderOptions:function(a){var c=this,d=[];return"string"==typeof a||a instanceof String?c._collectionRenderOptions[a]:a instanceof b.Collection?(d=[],c.eachCollection(function(b,c,e){c===a&&d.push(e)}),d):(d={},c.eachCollection(function(a,b,c){"undefined"==typeof d[this]&&(d[this]=[]),d[this].push(c)}),d)},renderBefore:function(){var b=this;if(b.container)return b.$container=a(b.container),b.$container.is(":hidden")?!1:b._silence===!0?!1:!0},renderAfter:function(){return this.trigger.apply(this,["rendered"].concat(Array.prototype.slice.call(arguments,0))),a(this.container).trigger("backchart.rendered",arguments),this},elFillParents:function(){this.$el.css({width:this.width?this.width+"px":"100%",height:this.height?this.height+"px":"100%"})},getChartOptions:function(){return null},__logAlert:function(a){window.alert(a)},_log:function(){if(window.console)return window.console;var a=this.__logAlert;return{log:a,info:a,warn:a,debug:a,error:a}}});return d}),function(a,b,c){"use strict";if("function"==typeof define&&define.amd)define(["jquery","../backchart.base/model"],function(a,b){return c(a,b)});else if("undefined"!=typeof module&&module.exports){var d=require("jquery"),e=require("../backchart.base/model");module.exports=c(d,e)}else for(var f=b.split("."),g=a||this,h=0;h<f.length;h++){var i=f[h],j=g[i];g=g[i]=h===f.length-1?c(a.jQuery||window.jQuery,a.backchart.base.model):j||{}}}(this,"backchart.amcharts.model",function(a,b){var c=b.extend({categoryField:null,valueField:null,colorField:null,dataDateFormat:null});return c}),function(a,b,c){"use strict";if("function"==typeof define&&define.amd)define(["jquery","../backchart.base/collection"],function(a,b){return c(a,b)});else if("undefined"!=typeof module&&module.exports){var d=require("jquery"),e=require("../backchart.base/collection");module.exports=c(d,e)}else for(var f=b.split("."),g=a||this,h=0;h<f.length;h++){var i=f[h],j=g[i];g=g[i]=h===f.length-1?c(a.jQuery||window.jQuery,a.backchart.base.collection):j||{}}}(this,"backchart.amcharts.collection",function(a,b){var c=b.extend({});return c}),function(a,b,c){"use strict";if("function"==typeof define&&define.amd)define(["jquery","../backchart.base/view","backbone","underscore","AmCharts"],function(a,b,d,e,f){return f=f||window.AmCharts,c(a,d,e,b,f)});else if("undefined"!=typeof module&&module.exports){var d=require("jquery"),e=require("../backchart.base/view"),f=require("backbone"),g=require("underscore"),h=require("AmCharts")||window.AmCharts;module.exports=c(d,f,g,e,h)}else for(var i=b.split("."),j=a||this,k=0;k<i.length;k++){var l=i[k],m=j[l];j=j[l]=k===i.length-1?c(a.jQuery||window.jQuery,a.Backbone||window.Backbone,a._||window._,a.backchart.base.view,a.amcharts||window.AmCharts):m||{}}}(this,"backchart.amcharts.view",function(a,b,c,d,e){var f=d.extend({graphsFieldsForConflictTest:["valueField","alphaField","bulletField","bulletSizeField","colorField","fillColorsField","labelColorField","lineColorField"],mergeData:"simple",keyFields:{serial:["categoryField"],pie:["titleField","valueField"]},constructor:function(){this.defaultGraphsOptions={balloonText:"<b>[[category]]: [[value]]</b>",valueField:"value"},this.multiValueAxes=!1,this.defaultAxesOptions={},this.defaultDateAxesOptions={equalSpacing:!0},this.defaultOptions={type:"serial"},d.apply(this,arguments)},initialize:function(b,c,e){return d.prototype.initialize.apply(this,arguments),this.defaultOptions=a.extend(!0,{},this.defaultOptions,b),this.defaultGraphsOptions=a.extend(!0,{},this.defaultGraphsOptions,c),this.defaultAxesOptions=a.extend(!0,{},this.defaultAxesOptions,e),this.__rendered=!1,this},__mergeToDataProvider:function(b,d,e,f){for(var g=this,h={},i=d.length-1;i>=0;i--){var j=d[i],k=-1;if("simple"===g.mergeData)k=i;else if("category"===g.mergeData)for(var l=e.length-1;l>=0;l--)if(e[l][b]instanceof Date&&j[b]instanceof Date&&e[l][b].valueOf()===j[b].valueOf()||e[l][b]===j[b]){k=l;break}if(k>=0&&j){for(var m in f){var n=f[m];if(j[n]&&"undefined"!=typeof e[k][n]){var o=h[n];o||(o=c.uniqueId(n),h[n]=o),j[o]=j[n],delete j[n]}}e[k]=a.extend(e[k],j)}else e.push(j)}for(var p in h)for(var q in f)f[q]===p&&(f[q]=h[p]);return f},_createGraph:function(b){var d=this,f=[],g=[],h=[];b.type||(b.type="serial");for(var i=d.keyFields[b.type]||[],j={},k=0;k<i.length;k++)j[i[k]]=b[i[k]]||"_"+i[k];return d.eachCollection(function(k,l,m){for(var n=[],o=a.extend(!0,{},d.defaultGraphsOptions,m.graph),p=l.model?new l.model:null,q={},r={},s=d.graphsFieldsForConflictTest.length-1;s>=0;s--){var t=d.graphsFieldsForConflictTest[s],u=l[t]||(p?p[t]:null);u&&(q[t]=u)}for(var v=0;v<i.length;v++){var w=i[v],x=p[w]||l[w]||b[w];x&&(r[w]=x,b[w]=j[w])}var y=!1;if(l.each(function(a){if(l.isVisibled(a)){var f=c.clone(a.attributes);for(var g in j){var h=r[g];h&&(f[j[g]]=a.get(h))}if("serial"===b.type&&(a.dataDateFormat||b.dataDateFormat))if(b.categoryAxis&&"undefined"!=typeof b.categoryAxis.parseDates){var k=a.dataDateFormat||b.dataDateFormat;if("undefined"==typeof f[i[0]])return void d._log().warn("One model's categoryField is undefined!!");f[i[0]]=e.stringToDate(f[i[0]],k),y=!0}else d._log().warn("One model's category field is Date Object, but not set categoryAxis.parseDates");n.push(f)}}),h.length?q=d.__mergeToDataProvider(i[0],n,h,q):h=n,o=a.extend(o,q),y&&(b.categoryAxis=a.extend(!0,{},b.categoryAxis,d.defaultDateAxesOptions)),m.axes)if(d.multiValueAxes===!0){var z=a.extend(!0,{},d.defaultAxesOptions,m.axes);z.id=c.uniqueId("_axes"),g.push(z),o.valueAxis=z.id}else g.length?d._log().info("We has ignored one valueAxes configuration because the multiValueAxes option is false."):g.push(a.extend(!0,{},d.defaultAxesOptions,m.axes));f.push(o)}),b.dataProvider=h,b.valueAxes=g,b.graphs=f,b},transformOptions:function(a){var b=this;return a=b._createGraph(a)},render:function(b){var f=this,g=d.prototype.renderBefore.apply(f,arguments);if(!g)return!1;f.el.id||(f.el.id=c.uniqueId(f._viewPrefix||"_bcname"));var h=c.clone(f.defaultOptions);return h=f.transformOptions(h),f.__cOptions=h,f.Chart&&!b?(f.trigger("beforeValidateData",f,f.el.id,h.dataProvider),f.Chart.dataProvider=h.dataProvider,void f.Chart.validateData()):(f.trigger("beforeRender",f,f.el.id,h),f.$container.empty().append(f.$el.empty()),f.elFillParents(),f.Chart=e.makeChart(f.el.id,a.extend(!0,{},h)),f.Chart.write(f.el.id),d.prototype.renderAfter.apply(f,[f,f.el,f.Chart,h]))},getChartOption:function(){return this.__cOptions}});return f});