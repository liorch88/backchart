/*! Backchart - v0.1.0 - 2014-02-13
* https://github.com/xch89820/backchart
* Copyright (c) 2014 xu.chenhui; Licensed MIT */
!function(a,b,c){"use strict";if("function"==typeof define&&define.amd)define(["jquery","../base/view","backbone","underscore","CanvasJS","moment"],function(a,b,d,e,f,g){return f=f||window.CanvasJS,c(a,d,e,b,f,g)});else if("undefined"!=typeof module&&module.exports){var d=require("jquery"),e=require("../base/view"),f=require("backbone"),g=require("underscore"),h=require("moment"),i=require("CanvasJS")||window.CanvasJS;module.exports=c(d,f,g,e,i,h)}else for(var j=b.split("."),k=a.jQuery||a.ender||a.$||a||this,l=0;l<j.length;l++){var m=j[l];k=k[m]=l===j.length-1?c(a.jQuery||window.jQuery,a.Backbone||window.Backbone,a._||window._,k.backchart.base.view,a.CanvasJS||window.CanvasJS,a.moment||window.moment):{}}}(this,"backchart.canvasjs.view",function(a,b,c,d,e,f){var g=d.extend({defaultRenderOptions:{type:"column",parseFormat:"YYYY-MM-DD"},initialize:function(b,c){d.prototype.initialize.apply(this,arguments),this.defaultOptions=a.extend(!0,{},this.defaultOptions,b),this.defaultRenderOptions=a.extend(!0,{},this.defaultRenderOptions,c)},transformData:function(b,d){var e=this,g=[],h=a.extend(!0,{},e.defaultRenderOptions,d);return b.each(function(a){var b=c.clone(a.attributes);if("dateTime"===h.xValueType&&!(b.x instanceof Date)&&"number"!=typeof b.x){var d=b.x.toString();b.x=f(d,h.parseFormat||"YYYY-MM-DD").toDate()}g.push(b)}),h.dataPoints=g,h},render:function(){var a=this,b=d.prototype.render.apply(a,arguments);if(!b)return!1;a.el.id||(a.el.id=c.uniqueId("backchartel"));var f=c.clone(a.defaultOptions);f.data=[],a.eachCollection(function(b,c,d,e){c._silence||e.visible===!1||f.data.push(a.transformData(c,d))}),a.$container.empty().append(a.$el.empty()),a.elFillParents(),a.Chart=new e.Chart(a.el.id,f),a.Chart.render(),d.prototype.renderEvents.apply(a,[a,a.el,a.Chart,f])}});return g});